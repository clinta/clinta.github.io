<!doctype html> 
<html lang="en-us"> 
<head>
	<meta name="generator" content="Hugo 0.55.6" />
  <meta charset="utf-8">
  <title></title>
  <meta name="author" content="Clint Armstrong">
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="icon" href="/favicon.png" />
  <link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png" />

  
  <link rel="stylesheet" href="/style.css" />
  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-58778705-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

</head>

<body class="">

  <div class="header center">
    <ul class="navbar">
	
	
		<li class="navbar"><a class="navbar" href="/">Posts</a></li>
	
	
	
		<li class="navbar"><a class="navbar" href="https://twitter.com/clinta">Twitter</a></li>
	
	
	
		<li class="navbar"><a class="navbar" href="/resume/">Resume</a></li>
	
	
	</ul>
  </div>

  <div class="wrap">
	

<main class="posts">
  <article class="post">
	
      <h1><a href="https://clinta.github.io/preventing-distrupting-reboots/">Preventing disrupting reboots with Ubuntu automatic updates</a></h1>
      <p>Keeping your systems up to date is important, and Ubuntu makes this fairly easy. It&rsquo;s also easy to enable automatic reboots when required for an update. The downside is that these updates can happen when they shouldn&rsquo;t. With some custom SystemD services you can replace the built in automatic-reboot functionaly with a system that waits until conditions are appropriate to reboot.
Start by enabling automatic updates, but make sure Unattended-Upgrade::Automatic-Reboot' is set to&ldquo;false&rdquo;`.</p>
	  <p class="small"><a href="https://clinta.github.io/preventing-distrupting-reboots/">2020-02-06</a></p>
    
      <h1><a href="https://clinta.github.io/ubuntu-unattended-upgrades-too-many-routes/">Ubuntu Unattended Upgrades Hangs With Too Many Routes</a></h1>
      <p>I recently discovered an issue on some of our routers running Ubuntu 16.04 where they would have a stuck unattended-updates process consuming 100% of a CPU core.
This issue only appears on routers wich are retrieving full route table from the internet, (at this time about 800k routes). I tracked the issue down to unattended-upgrades default setting of trying to determine if it&rsquo;s running on a metered connection.
This function relies on pygobjects NetworkManger.</p>
	  <p class="small"><a href="https://clinta.github.io/ubuntu-unattended-upgrades-too-many-routes/">2020-01-14</a></p>
    
      <h1><a href="https://clinta.github.io/systemd-dhcp-mtu-bug/">Bug with systemd bonds and DHCP MTU</a></h1>
      <p>After a recent update to systemd on Ubuntu 19.04 I ran into a bug which I was unable to find anybody talking about.
I use systemd-networkd to create lacp bonds. Then these lacp bonds get an IP address via dhcp. These bonds are also configured to set their MTU based on the dhcp options. This is done with the following files.
#/etc/systemd/network/eno.network [Match] Name=eno[1,2] [Network] Bond=bond0 DHCP=no LinkLocalAddressing=no IPv4LLRoute=no  #/etc/systemd/network/bond0.</p>
	  <p class="small"><a href="https://clinta.github.io/systemd-dhcp-mtu-bug/">2019-12-05</a></p>
    
      <h1><a href="https://clinta.github.io/bionic-on-apu2/">Installing Ubuntu 18.04 on an APU2</a></h1>
      <p>The PC Engines APU2 is a great little board to build a router on. We&rsquo;ve used several of them at work for branch offices, and I&rsquo;m using one for my home router now.
But with no video, these devices can be a bit intimidating to get setup for a new user. This guide will take you step-by-step through updating the firmware and installing Ubuntu 18.04 on one.
Before installing any software make sure you assemble the APU2 properly, pay special attention to how you install the CPU cooler.</p>
	  <p class="small"><a href="https://clinta.github.io/bionic-on-apu2/">2018-04-12</a></p>
    
      <h1><a href="https://clinta.github.io/getting-started-with-systemd-nspawnd/">Getting Started with systemd-nspawnd</a></h1>
      <p>I love container technologies. One of my most popular blog posts to date is my guide on FreeBSD Jails the Hard Way. This guide aims to be similar, but for creating containers on linux using systemd-nspawnd. Many people immediately think docker when they think linux container, but docker has a very specific vision for containers. Docker aims to build a collection of microservices where only a single process is running in a container.</p>
	  <p class="small"><a href="https://clinta.github.io/getting-started-with-systemd-nspawnd/">2018-04-11</a></p>
    
      <h1><a href="https://clinta.github.io/vms-containers-and-docker/">VMs Containers and Docker</a></h1>
      <p>This post is an explanation of what containers are, how they compare to vms, and where specific container technologies like docker, nspawn, and FreeBSD jails fit. This post is mostly to clarify terminology and help to to bring anyone who is unfamiliar with these concepts up to speed. This explanation is based on my experience over the last several years using these technologies and writing programs to make use of them.</p>
	  <p class="small"><a href="https://clinta.github.io/vms-containers-and-docker/">2018-04-08</a></p>
    
      <h1><a href="https://clinta.github.io/moving-to-hugo/">Moving to Hugo</a></h1>
      <p>If you notice things look a little different here, it&rsquo;s because I&rsquo;ve given up on Jekyll. Ever since github upgraded it I&rsquo;ve not been happy with how it does syntax highlighting and I&rsquo;ve been looking for alternatives. Hugo looks promising, and that&rsquo;s what I&rsquo;m trying now. Sometime soon I&rsquo;ll blog about my CI setup once it&rsquo;s running the way I like.</p>
	  <p class="small"><a href="https://clinta.github.io/moving-to-hugo/">2016-10-12</a></p>
    
      <h1><a href="https://clinta.github.io/salt-git-nogitfs/">Salt git integration without gitfs</a></h1>
      <p>SaltStack has some pretty cool git integration. Unfortunately it also has quite a few bugs, especially when using gitfs for pillars.
These issues can be annoying at small scale, but they can become very important as you add more minions. To work around these I looked for ways I could simplify our salt/git integration and now that it&rsquo;s complete I couldn&rsquo;t be happier.
With a post-receive hook on my gitlab server and a salt master that is also a minion, the salt server updates it&rsquo;s file root&rsquo;s directory from git without the salt-master process having to do any interfacing with git at all.</p>
	  <p class="small"><a href="https://clinta.github.io/salt-git-nogitfs/">2015-12-15</a></p>
    
      <h1><a href="https://clinta.github.io/random-local-passwords/">Random root passwords with saltstack.</a></h1>
      <p>Common passwords for devices is a significant security risk, but maintaining unique passwords for every server is nearly impossible without some password manager. But manually generating passwords for hundreds of servers and putting them into a password manager is just not practical. Here is a way to have your salt master generate complex random passwords for each minion and store them in a password manager where you can retrieve them later.</p>
	  <p class="small"><a href="https://clinta.github.io/random-local-passwords/">2015-09-24</a></p>
    
      <h1><a href="https://clinta.github.io/diy-sbs-for-office-365-unified-messaging/">Building your own Session Boarder Controller for SIP communication with Office 365.</a></h1>
      <p>If you&rsquo;re looking to connect an on-premise VOIP phone system to Office 365 you&rsquo;ll find several documents stating that you must purchase a session border controller, and a list of supported vendors. But if you&rsquo;re the kind of person who would rather take an unsupported approach than install yet another black box on your network, it can be done. In this guide I&rsquo;ll share what I&rsquo;ve learned over the last two weeks in building my own session boarder controller with open source software.</p>
	  <p class="small"><a href="https://clinta.github.io/diy-sbs-for-office-365-unified-messaging/">2015-08-24</a></p>
    
      <h1><a href="https://clinta.github.io/freebsd-jails-the-hard-way/">FreeBSD Jails the hard way</a></h1>
      <p>There are many great options for managing FreeBSD Jails. iocage, warden and ez-jail aim to streamline the process and make it quick an easy to get going. But sometimes the tools built right into the OS are overlooked.
This post goes over what is involved in creating and managing jails using only the tools built into FreeBSD.
For this guide, I&rsquo;m going to be putting my jails in /usr/local/jails.</p>
	  <p class="small"><a href="https://clinta.github.io/freebsd-jails-the-hard-way/">2015-08-09</a></p>
    
      <h1><a href="https://clinta.github.io/change-upn-to-email-with-powershell/">Changing UPN to Email with Powershell</a></h1>
      <p>If you need a quick way to change the UPN of all your users in active directory to match their email address, PowerShell makes it easy.
$users = get-aduser -SearchBase &#34;OU=Users,DC=ad,DC=contoso,DC=com&#34; -Filter * -Properties EmailAddress | where {$_.EmailAddress -ne $null -AND $_.EmailAddress.toLower() -ne $_.UserPrincipalName.toLower()} foreach ($user in $users) { $forest = Get-ADForest $email = $user.EmailAddress $username = $email.toLower().Split(&#39;@&#39;)[0] $userdomain = $email.toLower().Split(&#39;@&#39;)[1] if (-Not $($forest.UPNSuffixes).Contains($userdomain)) { $forest | Set-ADForest -UPNSuffixes @{Add=&#34;$userdomain&#34;} } $user | Set-ADUser -UserPrincipalName &#34;$username@$userdomain&#34; }</p>
	  <p class="small"><a href="https://clinta.github.io/change-upn-to-email-with-powershell/">2015-08-07</a></p>
    
      <h1><a href="https://clinta.github.io/mongodb-for-collectd/">Compiling the mongodb plugin for collectd</a></h1>
      <p>The MongoDB plugin for collectd is currently unfinished and hasn&rsquo;t had active development since 2012. Fortunately the folks at Stackdriver have fixed some of the issues so that the plugin works for their stackdriver agent, which is based on collectd. Unfortunately this code has not been submitted back upstream to collectd.
This means that if you want to monitor your own mongodb instances with collectd you&rsquo;ll need to build it yourself.</p>
	  <p class="small"><a href="https://clinta.github.io/mongodb-for-collectd/">2015-06-30</a></p>
    
      <h1><a href="https://clinta.github.io/secure-corporate-apt-repo/">Creating a Secure Corporate Apt Repository with Salt</a></h1>
      <p>There are many reasons an organization could use it&rsquo;s own internal apt repository. But controlling access to this repository for clients that are outside your internal network can be difficult. But if your repository contains proprietary or confidential packages, securing access is not optional. Thankfully apt supports client authentication with SSL certificates. And with the new x509 module, managing these certificates can be made fully automatic.
The x509 module is not yet in the latest release of salt, so you&rsquo;ll need to manually add it to your custom paths.</p>
	  <p class="small"><a href="https://clinta.github.io/secure-corporate-apt-repo/">2015-04-04</a></p>
    
      <h1><a href="https://clinta.github.io/salt-x509-details/">X509 Certificates in Salt, implementation details</a></h1>
      <p>Saltstack has recently accepted my pull request and integrated the x509 module I&rsquo;ve spent the last few weeks working on. Most of it&rsquo;s functionality including a complete PKI example is explained in the documentation, this blog post is to go over some more of the details of how and why I made it for anyone who may not want to just read the source code.
I started out with a need to manage X509 certificates for geographically distributed linux based VPN routers.</p>
	  <p class="small"><a href="https://clinta.github.io/salt-x509-details/">2015-04-02</a></p>
    
      <h1><a href="https://clinta.github.io/embracing-binary-for-beautiful-networks/">Embracing Binary for Beautiful Networks</a></h1>
      <p>During my time working for an MSP I got to see many different networks with many different techniques for mapping vlan numbers to subnets, but all of them left me dissatisfied. The biggest problem was that they were always designed to try to make some sense to people looking at the numbers as they&rsquo;re most commonly written. Vlan numbers in decimal and IP addresses in dotted decimal. But these are just incompatible.</p>
	  <p class="small"><a href="https://clinta.github.io/embracing-binary-for-beautiful-networks/">2015-03-07</a></p>
    
      <h1><a href="https://clinta.github.io/salt-user-management/">Managing Users with Salt</a></h1>
      <p>This post has gone through a few iterations. You can see the full history on the github repo.
One of the great things about a configuration management solution like Salt is the ability to centrally manage local users. Sure LDAP and Kerberos are great, but sometimes it&rsquo;s better to keep things simple, that&rsquo;s what I&rsquo;m doing with Salt. Leveraging Pillars I can define certain users to be added to servers of a given role.</p>
	  <p class="small"><a href="https://clinta.github.io/salt-user-management/">2015-03-07</a></p>
    
      <h1><a href="https://clinta.github.io/automated-pxe-ubuntu-installs/">Automated Ubuntu Installation with PXE, Preseeds and Apt-Cacher-NG (and UEFI compatible)</a></h1>
      <p>Doing repetitive installs can be a pain, and figuring out how to make it easier can be even more of a pain since everybody has their own preferred system. Most searching for how to do this for Ubuntu will lead you to Cobbler. Cobbler isn&rsquo;t a bad tool, but it&rsquo;s not a good fit for me. It takes away most of the ability to customize pxelinux without learning their templating language.</p>
	  <p class="small"><a href="https://clinta.github.io/automated-pxe-ubuntu-installs/">2015-01-28</a></p>
    
      <h1><a href="https://clinta.github.io/freenas-multipurpose-ssd/">Using one pair of SSDs for both ZIL and L2ARC in FreeNAS</a></h1>
      <p>I&rsquo;m a big fan of ZFS, and a big fan of FreeNAS. But some times the options avaliable in the FreeNAS GUI can&rsquo;t quite do everything. Using one disk for more than one purpose is one of those things. At $dayjob we&rsquo;re going to be using a new FreeNAS server for iSCSI datastores for VMWare. This is one of those instances where a ZIL can really improve performance because there is potential for a lot of synchronious writes from VMs hosting databases.</p>
	  <p class="small"><a href="https://clinta.github.io/freenas-multipurpose-ssd/">2015-01-21</a></p>
    
  </article>
</main>
</div>

</body>
</html>

