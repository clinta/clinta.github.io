<!doctype html> 
<html lang="en-us"> 
<head>
  <meta charset="utf-8">
  <title></title>
  <meta name="author" content="Clint Armstrong">
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="icon" href="/favicon.png" />
  <link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png" />

  
  <link rel="stylesheet" href="/style.css" />
  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-58778705-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

</head>

<body class="">

  <div class="header center">
    <ul class="navbar">
	
	
		<li class="navbar"><a class="navbar" href="/">Posts</a></li>
	
	
	
		<li class="navbar"><a class="navbar" href="https://twitter.com/clinta">Twitter</a></li>
	
	
	
		<li class="navbar"><a class="navbar" href="/resume/">Resume</a></li>
	
	
	</ul>
  </div>

  <div class="wrap">
	


<main>
<article class="post">
  <h1 class="title"><a href="https://clinta.github.io/mongodb-for-collectd/" title="Compiling the mongodb plugin for collectd">Compiling the mongodb plugin for collectd</a></h1>
  <p>The MongoDB <a href="https://collectd.org/wiki/index.php/Plugin:MongoDB">plugin</a> for collectd is currently unfinished and hasn&rsquo;t had active development since 2012. Fortunately the folks at <a href="https://github.com/Stackdriver">Stackdriver</a> have fixed some of the issues so that the plugin works for their stackdriver agent, which is based on collectd. Unfortunately this code has not been submitted back upstream to collectd.</p>

<p>This means that if you want to monitor your own mongodb instances with collectd you&rsquo;ll need to build it yourself.</p>

<p>Start by cloning the stackdriver repository and changing to the stackdriver agent branch.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">git clone https://github.com/Stackdriver/collectd
<span style="color:#007020">cd</span> collectd
git checkout stackdriver-agent-5.5.0</code></pre></div>
<p>The build script should help you find any missing dependencies you need to do the build.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">./build.sh</code></pre></div>
<p>Run the configure script, specifying only the mongodb module and instruct it to use the included libmongoc driver.</p>

<pre><code>./configure --enable-mongodb --disable-all-plugins --disable-daemon --with-libmongoc=own
</code></pre>

<p>The mongodb plugin is now compiled. Copy it from <code>src/.libs/mongodb.so</code> to <code>/usr/lib/collectd/</code> on your mongodb server and configure according to the plugin documentation.</p>

  <p class="small gray pubDate"><time datetime="2015-06-30">2015-06-30</time></p>
</article>
</main>
</div>

</body>
</html>

