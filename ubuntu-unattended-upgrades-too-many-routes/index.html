<!doctype html><html lang=en-us><head><meta charset=utf-8><title></title><meta name=author content="Clint Armstrong"><meta name=description content><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=/favicon.png><link rel=apple-touch-icon-precomposed href=/apple-touch-icon.png><link rel=stylesheet href=/style.css><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-58778705-1','auto');ga('send','pageview');}</script></head><body><div class="header center noPrint"><ul class=navbar><li class=navbar><a class=navbar href=/>Posts</a></li><li class=navbar><a class=navbar href=https://twitter.com/clinta>Twitter</a></li><li class=navbar><a class=navbar href=/resume/>Resume</a></li></ul></div><div class=wrap><main><article class=post><h1 class=title><a href=https://clinta.github.io/ubuntu-unattended-upgrades-too-many-routes/ title="Ubuntu Unattended Upgrades Hangs With Too Many Routes">Ubuntu Unattended Upgrades Hangs With Too Many Routes</a></h1><p>I recently discovered an issue on some of our routers running Ubuntu 16.04 where
they would have a stuck <code>unattended-updates</code> process consuming 100% of a CPU
core.</p><p>This issue only appears on routers wich are retrieving full route table from the
internet, (at this time about 800k routes). I tracked the issue down to
unattended-upgrades default setting of trying to determine if it&rsquo;s running on
a metered connection.</p><p>This function relies on pygobjects <code>NetworkManger.GetDefault()</code>, and this
function hangs indefinately when run on a machine with 800k routes.</p><p>A simple work around is to disable metered conection detecing in Apt.</p><pre><code>// /etc/apt/apt.conf.d/99-unattended-upgrades

Unattended-Upgrade::Skip-Updates-On-Metered-Connections &quot;false&quot;;
</code></pre><p>This bug has been reported to Ubuntu and is being tracked
<a href=https://bugs.launchpad.net/ubuntu/+source/pygobject/+bug/1859080>here</a>.</p><p class="small gray pubDate"><time datetime=2020-01-14>2020-01-14</time></p></article></main></div></body></html>